- task: Bash@3
  displayName: 'Install SQLCMD on Linux agent'
  inputs:
    targetType: 'inline'
    script: |
      echo "Installing mssql-tools..."
      sudo curl -sSL https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
      curl -sSL https://packages.microsoft.com/config/ubuntu/20.04/prod.list | sudo tee /etc/apt/sources.list.d/mssql-release.list
      sudo apt-get update
      sudo ACCEPT_EULA=Y apt-get install -y mssql-tools unixodbc-dev
      echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc
      source ~/.bashrc
      echo "sqlcmd version:"
      sqlcmd -?   # Verify installation




      steps:
- task: Bash@3
  displayName: 'Install SQLCMD'

- task: PowerShell@2
  displayName: 'Run automation process PowerShell script'
  inputs:
    targetType: 'filePath'
    filePath: './scripts/db-ping.ps1'
    arguments: >
      -ServerInstance "$(DB_HOST)"
      -Database "$(DB_NAME)"
      -Username "$(SQL_USER)"
      -Password "$(SQL_PASSWORD)"
    pwsh: true
